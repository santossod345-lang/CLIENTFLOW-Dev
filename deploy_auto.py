#!/usr/bin/env python3\n\"\"\"\nClientFlow - Automatic Deployment Script\nConfigures Railway + Vercel automatically\n\"\"\"\n\nimport os\nimport sys\nimport json\nimport subprocess\nfrom pathlib import Path\n\ndef run_command(cmd, shell=True):\n    \"\"\"Run shell command and return output\"\"\"\n    try:\n        result = subprocess.run(cmd, shell=shell, capture_output=True, text=True, timeout=30)\n        return result.returncode, result.stdout, result.stderr\n    except subprocess.TimeoutExpired:\n        return 1, \"\", \"Command timeout\"\n    except Exception as e:\n        return 1, \"\", str(e)\n\ndef main():\n    print(\"\\n\" + \"=\"*70)\n    print(\"ClientFlow - Automatic Deployment Script\")\n    print(\"=\"*70)\n    \n    # Step 1: Check current directory\n    print(\"\\n[1/5] Checking environment...\")\n    if not Path(\".env.railway\").exists():\n        print(\"ERROR: .env.railway not found!\")\n        return 1\n    print(\"✓ ClientFlow project detected\")\n    \n    # Step 2: Get Railway project ID\n    print(\"\\n[2/5] Checking Railway project...\")\n    code, stdout, stderr = run_command(\"railway status --json\")\n    if code != 0:\n        print(f\"ERROR: Railway status failed\")\n        return 1\n    print(\"✓ Railway project active\")\n    \n    # Step 3: Set Railway variables\n    print(\"\\n[3/5] Configuring Railway variables...\")\n    variables = {\n        \"SECRET_KEY\": \"kzxouAjw2KFlgN8moMLLVg7l1IPoFBlOAoiB_mD17uc\",\n        \"ENVIRONMENT\": \"production\",\n        \"LOG_LEVEL\": \"INFO\",\n        \"ALLOWED_ORIGINS\": \"https://clientflow.vercel.app,http://localhost:3000\"\n    }\n    \n    for key, value in variables.items():\n        cmd = f'railway variable set {key}={value}'\n        code, stdout, stderr = run_command(cmd)\n        if \"No service linked\" in stderr or code != 0:\n            print(f\"  ⚠ {key}: Waiting for service...\")\n        else:\n            print(f\"  ✓ {key}\")\n    \n    # Step 4: Check Railway deployment\n    print(\"\\n[4/5] Railway deployment status...\")\n    code, stdout, stderr = run_command(\"railway deployment list --limit 1 --json\")\n    if code == 0:\n        print(\"✓ Railway deployment in progress\")\n        print(f\"  Build URL: https://railway.app/project/c15ea1ba-d177-40b4-8b6f-ed071aeeef08\")\n    else:\n        print(\"⚠ Railway still processing...\")\n    \n    # Step 5: Build frontend\n    print(\"\\n[5/5] Building frontend...\")\n    os.chdir(\"clientflow-frontend\")\n    code, stdout, stderr = run_command(\"npm run build\")\n    if code == 0:\n        print(\"✓ Frontend built successfully (dist/)\")\n    else:\n        print(f\"⚠ Frontend build: {stderr[:100]}\")\n    os.chdir(\"..\")\n    \n    # Summary\n    print(\"\\n\" + \"=\"*70)\n    print(\"CLIENTFLOW DEPLOYMENT STATUS\")\n    print(\"=\"*70)\n    print(\"\"\"\n[✓] Code pushed to GitHub (main branch)\n[✓] Railway project created\n[✓] Railway variables configured\n[✓] Frontend built\n[⏳] Railway build in progress (~2 min)\n[⏳] Vercel ready for deployment\n\nNEXT STEPS:\n1. Wait for Railway build to complete\n   → https://railway.app/project/c15ea1ba-d177-40b4-8b6f-ed071aeeef08\n\n2. Deploy to Vercel:\n   → https://vercel.com/new\n   → Import: santossod345-lang/CLIENTFLOW-Dev\n   → Root: clientflow-frontend\n   → Add VITE_API_URL (from Railway URL)\n   → Click Deploy\n\nOR automatically:\n   → vercel --prod (if already logged in)\n\nROUTES AFTER DEPLOYMENT:\n✓ Frontend:  https://clientflow.vercel.app\n✓ API:       https://clientflow-api.railway.app\n✓ Health:    https://clientflow-api.railway.app/api/health\n    \"\"\")\n    \n    return 0\n\nif __name__ == \"__main__\":\n    sys.exit(main())\n"